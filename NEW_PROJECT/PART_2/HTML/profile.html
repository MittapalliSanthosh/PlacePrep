<!DOCTYPE html>
<html lang="en"> <!-- Theme class added by JS -->
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Profile Matrix - PlacePrep</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800;900&family=Orbitron:wght@400;500;700&display=swap" rel="stylesheet">
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">

    <style>
        /* ======== THEME VARIABLES (REFINED) ======== */
        :root {
            /* --- Base Colors --- */
            --bg-primary: #02040a;
            --bg-secondary: #0a0c12; 
            --bg-card: #0e1018;   
            --bg-card-alt: #12141c; 
            --bg-navbar: rgba(10, 10, 10, 0.7);
            --bg-navbar-scrolled: rgba(2, 4, 10, 0.85);
            --bg-theme-toggle-hover: #222222;

            /* --- Text Colors --- */
            --text-primary: #E0E0E0;
            --text-secondary: #B0B0B0;
            --text-muted: #8892b0;
            --text-headings: #FFFFFF;
            --text-logo: #FFFFFF;
            --text-nav-link: #A0A0A0;
            --text-nav-link-hover: #FFFFFF;
            --text-theme-toggle: #E0E0E0;
            
            /* --- Accent Colors --- */
            --accent-primary: #F97316; /* Main Orange */
            --accent-primary-hover: #EA580C;
            --accent-secondary: #00F0FF; /* Neon Cyan (Main Accent) */
            --accent-tertiary: #9333ea; /* Purple for gradients */
            
            /* --- Border Colors --- */
            --border-primary: #222630;
            --border-secondary: #303642;
            --border-highlight: var(--accent-secondary);
            --border-theme-toggle: #444444;

            /* --- Gradients & Effects --- */
            --gradient-profile-avatar: linear-gradient(135deg, var(--accent-secondary), var(--accent-tertiary));
            --gradient-heading-border: linear-gradient(90deg, var(--accent-secondary), transparent);
            --shadow-card: 0 10px 30px -15px rgba(0,0,0,0.7);
            --shadow-card-hover: 0 20px 40px -15px rgba(0,0,0,0.6);
            --shadow-accent-glow: 0 0 18px rgba(var(--accent-secondary-rgb), 0.6);
            --shadow-text-glow: 0 0 8px rgba(var(--accent-secondary-rgb), 0.5);

            /* --- RGB versions for rgba() --- */
            --accent-primary-rgb: 249,115,22;
            --accent-secondary-rgb: 0,240,255;

            /* --- Transition --- */
            --transition-speed: 0.3s;
            --transition-curve: cubic-bezier(0.25, 0.8, 0.25, 1);
        }

        html.light-mode {
            --bg-primary: #F0F2F5;
            --bg-secondary: #FFFFFF;
            --bg-card: #FFFFFF;
            --bg-card-alt: #F8F9FA;
            --bg-navbar: rgba(255, 255, 255, 0.7);
            --bg-navbar-scrolled: rgba(255, 255, 255, 0.9);
            --bg-theme-toggle-hover: #E9ECEF;

            --text-primary: #1A202C;
            --text-secondary: #475569;
            --text-muted: #6B7280;
            --text-headings: #0F172A;
            --text-logo: var(--accent-primary);
            --text-nav-link: #495057;
            --text-nav-link-hover: var(--accent-primary);
            --text-theme-toggle: #495057;

            --accent-secondary: #0891B2; /* Darker Cyan for light mode */
            --accent-tertiary: #7e22ce;
            
            --border-primary: #E2E8F0;
            --border-secondary: #CBD5E1;
            --border-highlight: var(--accent-secondary);
            --border-theme-toggle: #CED4DA;

            --gradient-profile-avatar: linear-gradient(135deg, var(--accent-secondary), var(--accent-tertiary));
            --gradient-heading-border: linear-gradient(90deg, var(--accent-secondary), transparent);

            --shadow-card: 0 8px 20px rgba(100, 116, 139, 0.1);
            --shadow-card-hover: 0 12px 30px rgba(100, 116, 139, 0.15);
            --shadow-accent-glow: 0 0 15px rgba(var(--accent-secondary-rgb), 0.4);
            --shadow-text-glow: 0 0 10px rgba(var(--accent-secondary-rgb), 0.3);

            --accent-secondary-rgb: 8,145,178;
        }

        /* ======== GENERAL & UTILITIES ======== */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Outfit', sans-serif; 
            background-color: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.65;
            transition: background-color var(--transition-speed) ease, color var(--transition-speed) ease;
        }

        .main-content-profile { padding: 3rem 0; }
        .container { max-width: 1000px; margin: 0 auto; padding: 0 1.5rem; }
        
        /* ======== SHARED CARD BASE STYLE ======== */
        .card-base {
            background-color: var(--bg-card);
            border: 1px solid var(--border-primary);
            border-radius: 12px;
            box-shadow: var(--shadow-card);
            transition: transform var(--transition-speed) var(--transition-curve), box-shadow var(--transition-speed) var(--transition-curve);
        }
        .card-base:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-card-hover);
        }

        /* ======== NAVIGATION ======== */
        .navbar {
            position: sticky; top: 0; width: 100%;
            background: var(--bg-navbar); backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--border-primary);
            z-index: 1000; padding: 1rem 0;
            transition: background-color var(--transition-speed) ease, border-bottom-color var(--transition-speed) ease;
        }
        html[data-page-scrolled="true"] .navbar { background: var(--bg-navbar-scrolled); }
        .nav-container { max-width: 1200px; margin: 0 auto; display: flex; justify-content: space-between; align-items: center; padding: 0 2rem; }
        .logo { font-size: 2rem; font-weight: 800; color: var(--text-logo); text-decoration: none; font-family: 'Orbitron', sans-serif; letter-spacing: 1px;}
        html.light-mode .logo { color: var(--accent-primary); }
        .nav-right-controls { display: flex; align-items: center; gap: 1rem; }
        .theme-toggle-btn {
            background: transparent; color: var(--text-theme-toggle); border: 1.5px solid var(--border-theme-toggle);
            padding: 0.5rem 0.8rem; border-radius: 8px; cursor: pointer; font-size: 1rem; transition: all var(--transition-speed) ease;
        }
        .theme-toggle-btn:hover { background: var(--bg-theme-toggle-hover); border-color: var(--border-hover); transform: scale(1.05); }
        

        /* ======== PROFILE COMMAND CENTER (ENHANCED) ======== */
        .profile-command-center {
            /* Inherits .card-base styles via class in HTML */
            padding: 2rem;
            margin-bottom: 2.5rem;
            display: flex; flex-direction: column;
            align-items: center; gap: 1rem; text-align: center;
            position: relative; overflow: hidden;
            /* Added a subtle top border highlight */
            border-top: 2px solid var(--border-highlight); 
        }
        .profile-command-center::before { /* Enhanced grid background */
            content: ''; position: absolute; top:0; left:0; right: 0; bottom: 0;
            background-image: 
                linear-gradient(var(--border-primary) 1px, transparent 1px),
                linear-gradient(to right, var(--border-primary) 1px, transparent 1px);
            background-size: 30px 30px;
            opacity: 0.2; z-index: 0;
        }
        .profile-command-center::after { /* Aurora glow from top */
            content: ''; position: absolute; top: 0; left: 50%;
            transform: translateX(-50%); width: 200%; height: 250px;
            background: radial-gradient(circle, rgba(var(--accent-secondary-rgb), 0.15) 0%, transparent 60%);
            z-index: 0; pointer-events: none;
        }

        .profile-avatar {
            width: 140px; height: 140px; border-radius: 50%;
            background: var(--gradient-profile-avatar);
            display: grid; place-items: center; /* Simplifies centering */
            font-size: 4.5rem; color: white; font-weight: 700;
            font-family: 'Orbitron', sans-serif;
            border: 5px solid var(--bg-card);
            box-shadow: 0 0 0 2px var(--border-primary), var(--shadow-accent-glow), var(--shadow-card);
            position: relative; z-index: 1;
            transition: transform var(--transition-speed) ease;
        }
        .profile-avatar:hover { transform: scale(1.05) rotate(5deg); }
        .profile-avatar img { width:100%; height:100%; object-fit:cover; border-radius:50%; }

        .user-identity { position: relative; z-index: 1; }
        .user-identity h1 {
            font-family: 'Orbitron', sans-serif; font-size: 2.5rem;
            font-weight: 700; color: var(--text-headings); margin-bottom: 0.5rem;
            letter-spacing: 1.5px;
        }
        .user-identity .department-tag {
            display: inline-block;
            background-color: color-mix(in srgb, var(--accent-secondary) 15%, transparent); /* Tinted background */
            color: var(--accent-secondary);
            padding: 0.4rem 1rem; border-radius: 6px; font-size: 0.8rem;
            font-weight: 600; border: 1px solid var(--accent-secondary);
            margin-bottom: 1rem;
            text-shadow: var(--shadow-text-glow);
            letter-spacing: 0.5px;
        }
         .user-identity .user-email { color: var(--text-secondary); font-size: 1rem; }

        .edit-profile-fab { /* Orange action button */
            background: var(--accent-primary); color: white;
            border: none; width: 50px; height: 50px; border-radius: 50%;
            font-size: 1.2rem;
            box-shadow: 0 4px 12px rgba(var(--accent-primary-rgb), 0.3);
            cursor: pointer;
            transition: all var(--transition-speed) ease;
            display: grid; place-items: center; /* Simplifies centering */
            margin-top: 1rem; position: relative; z-index: 1;
        }
        .edit-profile-fab:hover {
            background: var(--accent-primary-hover);
            transform: translateY(-3px) scale(1.08);
            box-shadow: 0 8px 18px rgba(var(--accent-primary-rgb), 0.4);
        }
        
        /* ======== STATS GRID (ENHANCED) ======== */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem; margin-bottom: 2.5rem;
        }
        .stat-pod { 
            padding: 1.75rem 1.5rem; text-align: center;
            /* Creates a layered background feel */
            background-image: radial-gradient(circle at 50% 0%, color-mix(in srgb, var(--accent-secondary) 8%, transparent) 0%, transparent 50%);
        }
        .stat-pod .stat-icon {
            font-size: 2.2rem; color: var(--accent-secondary);
            margin-bottom: 1rem; height: 40px; text-shadow: var(--shadow-text-glow);
        }
        .stat-pod .stat-value {
            font-size: 2.5rem; font-weight: 700;
            font-family: 'Orbitron', sans-serif;
            color: var(--text-headings); line-height: 1; margin-bottom: 0.5rem;
        }
        .stat-pod .stat-label { color: var(--text-secondary); font-size: 0.9rem; }
        
        /* ======== PROFILE DETAILS (ENHANCED) ======== */
        .details-section-container {
             /* Inherits .card-base styles via class in HTML */
            padding: 2.5rem;
        }
        .details-section { margin-bottom: 2.5rem; }
        .details-section:last-child { margin-bottom: 0; }
        .details-section h2 {
            font-size: 1.5rem; font-weight: 600;
            margin-bottom: 1.5rem; color: var(--text-headings);
            padding-bottom: 0.75rem;
            border-bottom: 1px solid;
            /* Creates a fading gradient line for the border */
            border-image-source: var(--gradient-heading-border);
            border-image-slice: 1;
            display: flex; align-items: center; gap: 0.75rem; letter-spacing: 0.5px;
        }
        .details-section h2 i { color: var(--accent-secondary); font-size: 0.9em; }

        .details-grid {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
        }
        .detail-item {
            background: var(--bg-card-alt);
            border: 1px solid var(--border-primary);
            /* Adds a colored highlight bar on the left */
            border-left: 3px solid var(--border-secondary); 
            border-radius: 8px; padding: 1rem 1.2rem;
            transition: background-color var(--transition-speed) ease, border-left-color var(--transition-speed) ease;
        }
        .detail-item:hover {
            background-color: var(--bg-secondary);
            border-left-color: var(--accent-secondary); /* Highlight on hover */
        }
        .detail-label {
            color: var(--text-muted); font-size: 0.8rem;
            margin-bottom: 0.3rem; text-transform: uppercase; letter-spacing: 1px;
        }
        .detail-value {
            color: var(--text-primary); font-size: 1rem; font-weight: 500;
            word-break: break-word; /* Better than break-all */
        }

        /* ======== MEDIA QUERIES (ADJUSTED) ======== */
        @media (max-width: 768px) {
            .container { padding: 0 1rem; }
            .profile-command-center { padding: 2rem 1.5rem; gap:1rem; }
            .profile-avatar { width: 120px; height: 120px; font-size: 4rem; border-width: 4px;}
            .user-identity h1 { font-size: 2rem; }
            .user-identity .department-tag { font-size: 0.75rem; }
            .edit-profile-fab { width: 48px; height: 48px; font-size: 1.1rem; }
            .stats-grid { grid-template-columns: repeat(2, 1fr); gap: 1rem; }
            .stat-pod .stat-value { font-size: 2rem; }
            .details-section h2 { font-size: 1.3rem; }
        }
        @media (max-width: 480px) {
            .stats-grid { grid-template-columns: 1fr; }
            .details-grid { grid-template-columns: 1fr; }
            .user-identity h1 { font-size: 1.8rem; letter-spacing: 1px; }
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <a href="placement_website.html" class="logo">PlacePrep</a>
            <div class="nav-right-controls">
                 <button id="theme-toggle-btn" class="theme-toggle-btn" aria-label="Toggle theme">
                    <i class="fas fa-moon"></i> <!-- JS will set correct icon -->
                </button>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="main-content-profile">
        <div class="container">
            <!-- Profile Command Center Header -->
            <div class="profile-command-center card-base" data-aos="fade-down" data-aos-duration="600">
                <div class="profile-avatar" id="profileAvatar">
                     <i class="fas fa-user-astronaut"></i> <!-- Placeholder -->
                </div>
                <div class="user-identity">
                    <h1 id="profileUserName">User FullName</h1>
                    <div class="department-tag" id="profileUserDepartment">Department Field</div>
                    <p class="user-email" id="profileUserEmail">user.email@example.com</p>
                </div>
                 <button class="edit-profile-fab" onclick="editProfile()" aria-label="Edit Profile">
                    <i class="fas fa-pencil-alt"></i>
                </button>
            </div>

            <!-- Profile Stats Grid -->
            <div class="stats-grid" data-aos="fade-up" data-aos-delay="100" data-aos-duration="600">
                <div class="stat-pod card-base">
                    <div class="stat-icon"><i class="fas fa-tasks"></i></div>
                    <div class="stat-value" id="overallProgressStat">0%</div>
                    <div class="stat-label">Overall Progress</div>
                </div>
                <div class="stat-pod card-base">
                    <div class="stat-icon"><i class="fas fa-book-open"></i></div>
                    <div class="stat-value" id="topicsCompletedStat">0</div>
                    <div class="stat-label">Topics Mastered</div>
                </div>
                <div class="stat-pod card-base">
                     <div class="stat-icon"><i class="fas fa-diagnoses"></i></div>
                    <div class="stat-value" id="testsTakenStat">0</div>
                    <div class="stat-label">Assessments Taken</div>
                </div>
                <div class="stat-pod card-base">
                     <div class="stat-icon"><i class="fas fa-bullseye"></i></div>
                    <div class="stat-value" id="avgScoreStat">N/A</div>
                    <div class="stat-label">Average Score</div>
                </div>
            </div>

            <!-- Profile Details Pod -->
            <div class="details-section-container card-base" data-aos="fade-up" data-aos-delay="200" data-aos-duration="600">
                <div class="details-section">
                    <h2><i class="fas fa-id-card"></i> Personal Information</h2>
                    <div class="details-grid">
                        <div class="detail-item">
                            <div class="detail-label">First Name</div>
                            <div class="detail-value" id="infoFirstName">Loading...</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Last Name</div>
                            <div class="detail-value" id="infoLastName">Loading...</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Registered Email</div>
                            <div class="detail-value" id="infoEmail">Loading...</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Primary Department</div>
                            <div class="detail-value" id="infoDepartment">Loading...</div>
                        </div>
                    </div>
                </div>

                <div class="details-section">
                    <h2><i class="fas fa-chart-line"></i> Academic & Preparation Snapshot</h2>
                    <div class="details-grid">
                        <div class="detail-item">
                            <div class="detail-label">Total Topics Covered</div>
                            <div class="detail-value" id="infoTopicsCovered">0/0</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Recent Test Performance</div>
                            <div class="detail-value" id="infoTestPerformance">N/A</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Mock Interviews Completed</div>
                            <div class="detail-value" id="infoInterviewsDone">0</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Last Logged In</div>
                            <div class="detail-value" id="infoLastActive">Loading...</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

<script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
<script>
    // Animation library initialization
    AOS.init({
        once: true, // Only animate elements once
        offset: 50, // Animate a little earlier
    });

    // All existing JavaScript functionality is kept the same
    document.addEventListener('DOMContentLoaded', function() {
        // --- Theme Toggle ---
        const themeToggleButton = document.getElementById('theme-toggle-btn');
        const htmlElement = document.documentElement;
        let currentIcon = themeToggleButton ? themeToggleButton.querySelector('i') : null;

        function setTheme(theme) {
            const isLight = theme === 'light';
            htmlElement.classList.toggle('light-mode', isLight);
            if (currentIcon) currentIcon.className = isLight ? 'fas fa-moon' : 'fas fa-sun';
            localStorage.setItem('theme', theme);
        }
        const savedTheme = localStorage.getItem('theme') || (window.matchMedia('(prefers-color-scheme: light)').matches ? 'light' : 'dark');
        setTheme(savedTheme);
         if (themeToggleButton) {
            themeToggleButton.addEventListener('click', () => {
                setTheme(htmlElement.classList.contains('light-mode') ? 'dark' : 'light');
            });
        }
        
        // --- Navbar Scroll Effect ---
        const navbar = document.querySelector('.navbar');
        window.addEventListener('scroll', () => {
            document.documentElement.setAttribute('data-page-scrolled', window.scrollY > 20);
        });


        // --- Load User Data ---
        const userData = JSON.parse(localStorage.getItem('user')) || {}; // From login
        const firstName = localStorage.getItem('firstName') || userData.firstName || "User"; // Prioritize direct firstName

        // Simulated progress data - replace with actual fetched data
        const mockTestData = JSON.parse(localStorage.getItem('mockTestProgress')) || { testsCompleted: 5, averageScore: 78, totalTests: 10 };
        const topicsProgress = JSON.parse(localStorage.getItem('cseDepartmentProgress')) || { // Example from CSE page
            'dsa': { topics: [{completed:true},{completed:true},{completed:false},{completed:true}]},
            'system-design': { topics: [{completed:true},{completed:false},{completed:true}]},
            'networking': { topics: [{completed:true},{completed:false},{completed:false}]}
        };
        const interviewProgress = JSON.parse(localStorage.getItem('interviewProgress')) || { completed: 2, score: 80 };


        // Calculate total topics and completed topics from potentially multiple department progresses
        let totalTopicsOverall = 0;
        let completedTopicsOverall = 0;
        
        for (const catKey in topicsProgress) {
            if (topicsProgress[catKey] && topicsProgress[catKey].topics) {
                totalTopicsOverall += topicsProgress[catKey].topics.length;
                completedTopicsOverall += topicsProgress[catKey].topics.filter(t => t.completed).length;
            }
        }
        
        const overallProgress = calculateOverallProgress(
            mockTestData.averageScore || 0, 
            totalTopicsOverall > 0 ? (completedTopicsOverall / totalTopicsOverall) * 100 : 0, 
            interviewProgress.completed > 0 ? interviewProgress.score : 0
        );

        // Update Profile Header
        const profileAvatar = document.getElementById('profileAvatar');
        if (firstName) {
            profileAvatar.innerHTML = firstName.charAt(0).toUpperCase();
        }
        // if (userData.profilePictureUrl) { 
        //    profileAvatar.innerHTML = `<img src="${userData.profilePictureUrl}" alt="${firstName}'s profile">`;
        // }
        document.getElementById('profileUserName').textContent = `${firstName} ${userData.lastName || ''}`.trim();
        document.getElementById('profileUserDepartment').textContent = userData.department || 'Aspiring Developer';
        document.getElementById('profileUserEmail').textContent = userData.email || 'N/A';

        // Update Stats Grid
        document.getElementById('overallProgressStat').textContent = `${Math.round(overallProgress)}%`;
        document.getElementById('topicsCompletedStat').textContent = completedTopicsOverall;
        document.getElementById('testsTakenStat').textContent = mockTestData.testsCompleted || 0;
        document.getElementById('avgScoreStat').textContent = mockTestData.averageScore ? `${mockTestData.averageScore.toFixed(1)}%` : 'N/A';

        // Update Personal Information Details
        document.getElementById('infoFirstName').textContent = firstName || 'Not Set';
        document.getElementById('infoLastName').textContent = userData.lastName || 'Not Set';
        document.getElementById('infoEmail').textContent = userData.email || 'Not Set';
        document.getElementById('infoDepartment').textContent = userData.department || 'Not Set';

        // Update Academic Progress Details
        document.getElementById('infoTopicsCovered').textContent = `${completedTopicsOverall} / ${totalTopicsOverall || 'N/A'}`;
        document.getElementById('infoTestPerformance').textContent = mockTestData.averageScore ? `${mockTestData.averageScore.toFixed(1)}% Avg.` : 'N/A';
        document.getElementById('infoInterviewsDone').textContent = `${interviewProgress.completed || 0} Completed`;
        const lastActive = localStorage.getItem('lastLoginDate') || new Date().toISOString();
        document.getElementById('infoLastActive').textContent = formatLastActive(lastActive);
         localStorage.setItem('lastLoginDate', new Date().toISOString());

        const addNoteForm = document.getElementById('add-note-form');
        addNoteForm.onsubmit = async (e) => {
            e.preventDefault();
            const user = firebase.auth().currentUser;
            if (!user) {
                alert('Please log in to add notes');
                return;
            }
            const idToken = await user.getIdToken();
            const noteData = {
                title: document.getElementById('note-title').value,
                description: document.getElementById('note-description').value,
                category: document.getElementById('note-category').value,
                keyPoints: document.getElementById('key-points').value.split('\n').filter(point => point.trim()),
            };
            const response = await fetch('/api/notes', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${idToken}`
                },
                body: JSON.stringify(noteData)
            });
            if (response.ok) {
                alert('Note added!');
                addNoteForm.reset();
                document.getElementById('add-note-modal').style.display = 'none';
                fetchUserNotes(); // Refresh notes
            } else {
                alert('Failed to add note');
            }
        };
    });

    function calculateOverallProgress(testScorePercent, topicsCompletePercent, interviewScorePercent) {
        testScorePercent = Math.max(0, Math.min(100, Number(testScorePercent) || 0));
        topicsCompletePercent = Math.max(0, Math.min(100, Number(topicsCompletePercent) || 0));
        interviewScorePercent = Math.max(0, Math.min(100, Number(interviewScorePercent) || 0));

        const testWeight = 0.35;    
        const topicsWeight = 0.45;    
        const interviewWeight = 0.20; 

        return (
            (testScorePercent * testWeight) +
            (topicsCompletePercent * topicsWeight) +
            (interviewScorePercent * interviewWeight)
        );
    }

    function formatLastActive(isoString) {
        const date = new Date(isoString);
        const now = new Date();
        const diffTime = Math.abs(now - date);
        const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));

        if (isNaN(date.getTime())) return 'N/A';
        if (diffDays === 0) return 'Today';
        if (diffDays === 1) return 'Yesterday';
        if (diffDays < 7) return `${diffDays} days ago`;
        return date.toLocaleDateString(undefined, { year: 'numeric', month: 'short', day: 'numeric' });
    }

    function editProfile() {
        const currentFirstName = localStorage.getItem('firstName') || '';
        const currentUserData = JSON.parse(localStorage.getItem('user')) || {};
        const newFirstName = prompt('Update First Name:', currentFirstName);
        const newLastName = prompt('Update Last Name:', currentUserData.lastName || '');
        const newDepartment = prompt('Update Department:', currentUserData.department || '');

        if (newFirstName !== null) localStorage.setItem('firstName', newFirstName);
        
        const updatedUserData = {
            ...currentUserData,
            firstName: newFirstName !== null ? newFirstName : currentFirstName,
            lastName: newLastName !== null ? newLastName : (currentUserData.lastName || ''),
            department: newDepartment !== null ? newDepartment : (currentUserData.department || '')
        };
        localStorage.setItem('user', JSON.stringify(updatedUserData));
        location.reload(); 
    }
</script>
</body>
</html>